models:
  - name: stg_anime__details
    description: "Staging table for anime details, cleaned and deduplicated."
    columns:
      - name: anime_id
        description: "Surrogate key for the anime (from mal_id)."
        tests:
          - not_null
          - unique
      - name: title
        description: "Title of the anime."
        tests:
          - not_null
      - name: title_japanese
        description: "Japanese title of the anime."
      - name: type
        description: "Type of anime (e.g., TV, Movie)."
      - name: status
        description: "Status of the anime (e.g., Finished, Airing)."
      - name: rank
        description: "Rank of the anime."
      - name: score
        description: "Average score of the anime."
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 10
      - name: scored_by
        description: "Number of users who scored the anime."
      - name: popularity
        description: "Popularity rank."
      - name: members
        description: "Number of members in the community."
      - name: favorites
        description: "Number of favorites."
      - name: episodes
        description: "Number of episodes."
      - name: year
        description: "Year of release."
      - name: season
        description: "Season of release (e.g., Winter, Spring)."
      - name: source
        description: "Original source material of the anime."
      - name: rating
        description: "Rating of the anime (e.g., PG-13)."
      - name: demographics
        description: "Target demographic of the anime (e.g., Shounen)."
      - name: url
        description: "Link to anime page."
      - name: image_url
        description: "URL to the anime image."
      - name: synopsis
        description: "Synopsis or description of the anime."
      - name: start_date
        description: "Start date of the anime."
      - name: end_date
        description: "End date of the anime."
      - name: ingestion_ts
        description: "Timestamp when this record was ingested."

  - name: stg_anime__favs
    description: "Staging table for user favorites, cleaned and deduplicated."
    columns:
      - name: username
        description: "Username of the user who marked the favorite."
        tests:
          - not_null
      - name: fav_type
        description: "Type of favorite (e.g., anime, character, etc.)."
        tests:
          - not_null
      - name: entity_id
        description: "Surrogate key for the favorite entity (from source id)."
        tests:
          - not_null
          - unique
      - name: last_updated_at
        description: "Timestamp when this record was ingested."

  - name: stg_anime__genres
    description: "Staging table with unique genres extracted from anime DETAILS."
    columns:
      - name: genre_id
        description: "Surrogate key for the genre."
        tests:
          - not_null
          - unique
      - name: genre_name
        description: "Name of the genre (cleaned, lowercased)."
        tests:
          - not_null   

  - name: stg_anime__genres_join
    description: "Join table linking animes with their genres."
    columns:
      - name: anime_id
        description: "Foreign key referencing anime_id in stg_anime_details."
        tests:
          - not_null
          - dbt_utils.relationships:
              to: ref('stg_anime_details')
              field: anime_id
      - name: genre_id
        description: "Foreign key referencing genre_id in stg_genres."
        tests:
          - not_null
          - dbt_utils.relationships:
              to: ref('stg_genres')
              field: genre_id
      - name: anime_genre_key
        description: "Surrogate key for the anime-genre combination."
        tests:
          - not_null
          - unique
           
    
  - name: stg_anime__licensors
    description: "Staging table with unique licensors extracted from anime DETAILS."
    columns:
      - name: licensor_id
        description: "Surrogate key for the licensor."
        tests:
          - not_null
          - unique
      - name: licensor_name
        description: "Name of the licensor (cleaned, lowercased)."
        tests:
          - not_null

  - name: stg_anime__person_details
    description: "Staging table for person details"
    columns:
      - name: person_id
        description: Surrogate key for person
        tests:
          - not_null
          - unique
      - name: name
      - name: given_name
      - name: family_name
      - name: birthday
      - name: favorites    

  - name: stg_anime__person_about
    description: "Person biography/narrative about text"
    columns:
      - name: person_id
        description: Foreign key to stg_anime__person_details
        tests:
          - not_null
          - dbt_utils.relationships:
              to: ref('stg_person_details')
              field: person_id
      - name: person_mal_id
      - name: narrative_about_text
      - name: last_updated_at         

 
     

  - name: stg_themes
    description: "Unique themes from anime details"
    columns:
      - name: theme_id
        description: Surrogate key for theme
        tests:
        - not_null
        - unique
      - name: theme_name
        description: Name of the theme

  - name: stg_anime_themes
    description: "Join table linking animes with themes"
    columns:
      - name: anime_id
        description: Foreign key to stg_anime_details
        tests:
          - not_null
          - dbt_utils.relationships:
              to: ref('stg_anime_details')
              field: anime_id
      - name: theme_id
        description: Foreign key to stg_themes
        tests:
          - not_null
          - dbt_utils.relationships:
               to: ref('stg_themes')
               field: theme_id
      - name: anime_theme_key
        description: Surrogate key for anime-theme combination
        tests:
          - not_null
          - unique
        

  - name: stg_anime__person_anime_works
    description: "Staging table deduplicating person-anime works"
    columns:
      - name: person_id
        description: Surrogate key for PERSON_MAL_ID
        tests:
          - not_null
      - name: anime_id
        description: Surrogate key for ANIME_MAL_ID
        tests:
          - not_null
      - name: position
        description: Position of the person in the anime (cleaned)
        tests:
        - not_null


  